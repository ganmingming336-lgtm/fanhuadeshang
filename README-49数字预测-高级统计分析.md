# 49数字预测工具 - 高级统计分析方法说明

本文档对应：`number-predictor.html`（单文件离线版）。

> 说明：彩票结果本质上应当是随机的，本工具所有“预测”仅用于统计学习与娱乐参考，不构成任何投注建议。

## 目标

在保留原有分析逻辑（含“避开最近 N 期出现过的数字”过滤策略）的基础上，新增 3 种更偏统计学/数据分析视角的方法，并提供“全方法综合分”（加权平均）作为默认 Top K 推荐依据。

## 方法一：卡方检验（Chi-Square Test）

用于衡量单个数字出现次数相对“均匀分布期望”的偏离程度。

### 核心公式

对每个数字 i：

- 观测值：`O_i = count_i`
- 期望值：`E = totalNumbers / 49`
- 卡方残差（单项贡献）：

```
χ²_i = (O_i - E)^2 / E
```

### 分数转换（0-100）

- 计算所有数字的 `max(χ²_i)`
- 归一化为：

```
chiScore_i = (χ²_i / maxChi) * 100
```

> 值越大表示偏离均匀分布越明显，可能存在统计异常或样本波动。

## 方法二：蒙特卡洛模拟（Monte Carlo Simulation）

基于历史频率分布进行大量随机模拟，统计每个数字在模拟中被抽到的次数，并转换为预测分数。

### 规则

- 默认模拟次数：1000 次
- 每次模拟抽取“下一期的号码个数”
  - 通过历史每期号码个数的众数（mode）自动推断
- 抽样遵循“避开最近 N 期出现过的数字”
- 加权抽样依据历史频率（并使用轻微平滑避免权重为 0）：

```
weight_i = count_i + 1
```

### 概率与分数

- 模拟总抽取次数：`totalPicks = iterations * drawSize`
- 数字 i 在模拟中出现次数：`hits_i`
- 预测概率（百分比）：

```
prob_i = (hits_i / totalPicks) * 100
```

- 为便于与其他算法共同加权，本工具将概率再做一次 0-100 归一化：

```
monteCarloScore_i = (prob_i / maxProb) * 100
```

## 方法三：时间序列分析（Time Series Analysis）

将“某数字在某一期是否出现”视为一个 0/1 序列，尝试捕捉：趋势、自相关与滑动平均变化。

### 1) 趋势分析（Trend）

- `overallRate`：全局出现率
- `recentRate`：最近窗口（默认约为总期数的 20%，限制在 5~20 期）出现率

将“最近/全局”的比值映射到 0-100：

```
trendScore = clamp(50 + (recentRate/overallRate - 1) * 50, 0, 100)
```

### 2) 自相关（Autocorrelation, lag=1）

计算 0/1 序列的一阶自相关系数（lag1），取其绝对值作为“规律性”强弱：

```
autocorrScore = abs(lag1) * 100
```

### 3) 滑动平均（Moving Average）

比较短窗口与长窗口（默认约为总期数的 50%）的平均出现率差异：

```
movingAvgScore = clamp(50 + (maShort - maLong) * 100, 0, 100)
```

### 4) 时间序列综合

```
rawTS = 0.45 * trendScore + 0.25 * autocorrScore + 0.30 * movingAvgScore
```

并在 49 个数字间再归一化为 0-100：

```
timeSeriesScore = (rawTS / maxRawTS) * 100
```

## 全方法综合分（All-Methods Combined）

为了满足“原有 + 新增方法同时参与”的综合推荐，本工具计算：

- 频率分
- 冷号分
- 周期分
- 综合分（原有：频率/冷号/周期加权）
- 卡方分
- 蒙特卡洛分
- 时间序列分

默认权重为等权（每项权重=1）：

```
overallScore = average(
  freq, gap, period, comprehensive, chi, monteCarlo, timeSeries
)
```

同时，为保持原有逻辑不变，工具仍保留“经典最终分”（综合分 + 卡方分加权）作为对照。

## 界面与导出变化

- **Top K 推荐**：默认按“全方法综合分”排序（并避开最近 N 期出现数字）
- **算法对比 Tab**：展示每种方法的 Top K，并显示与“全方法综合”重合数量
- **统计表**：新增列：蒙特卡洛分、时间序列分、全方法综合分、经典最终分
- **导出 JSON/CSV**：新增导出蒙特卡洛与时间序列相关字段（含 MonteCarloProb、Hits 等）

---

如需调整权重、增加更多时间序列窗口或将 Monte Carlo 次数做成可配置项，可在后续迭代中扩展。
